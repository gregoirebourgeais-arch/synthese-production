// === PANNEAU FLOTTANT (Semaine + Date + Heure) ===
function updateDateTime() {
  const now = new Date();
  const jour = now.toLocaleDateString("fr-FR", {
    weekday: "long",
    day: "2-digit",
    month: "2-digit",
    year: "numeric"
  });
  const heure = now.toLocaleTimeString("fr-FR", {
    hour: "2-digit",
    minute: "2-digit"
  });

  const tempDate = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));
  const jourNum = tempDate.getUTCDay() || 7;
  tempDate.setUTCDate(tempDate.getUTCDate() + 4 - jourNum);
  const anneeDebut = new Date(Date.UTC(tempDate.getUTCFullYear(), 0, 1));
  const semaine = Math.ceil(((tempDate - anneeDebut) / 86400000 + 1) / 7);

  document.getElementById("date-jour").textContent = jour;
  document.getElementById("heure-actuelle").textContent = heure;
  document.getElementById("semaine-num").textContent = semaine;
}
setInterval(updateDateTime, 1000);
updateDateTime();

// === CALCULATRICE ===
function ouvrirCalculatrice() {
  const res = prompt("üßÆ Entrez une op√©ration (ex: 1250/3 ou 250+420) :");
  if (res === null || res.trim() === "") return;
  try {
    const resultat = eval(res);
    alert("R√©sultat : " + resultat);
  } catch {
    alert("‚ö†Ô∏è Op√©ration invalide !");
  }
}

// === PAGE ATELIER ===
function openPage(page) {
  const content = document.getElementById("content");
  content.innerHTML = `<div class="card"><h2>Chargement...</h2></div>`;

  setTimeout(() => {
    if (page === "Atelier") {
      content.innerHTML = `
        <div class="card">
          <h3>R√©sum√© Atelier</h3>
          <label>Quantit√© restante (colis) :</label>
          <input type="number" id="qteRestante" placeholder="ex : 1200" oninput="majFinPrevue()" />
          <p id="finPrevue"></p>
          <canvas id="graphGlobal"></canvas>
        </div>
      `;
      renderGraph("graphGlobal");
    } else {
      content.innerHTML = `
        <div class="card">
          <h2>${page}</h2>
          <label>Quantit√© restante :</label>
          <input type="number" id="qteRestante" placeholder="ex : 800" oninput="majFinPrevue()" />
          <p id="finPrevue"></p>
          <canvas id="graphLigne"></canvas>
        </div>
      `;
      renderGraph("graphLigne");
    }
  }, 200); // petit d√©lai pour √©viter ‚Äúchargement infini‚Äù
}

// === HEURE DE FIN ESTIM√âE ===
function majFinPrevue() {
  const qte = parseFloat(document.getElementById("qteRestante").value);
  const cadenceMoyenne = 450;
  const p = document.getElementById("finPrevue");
  if (!qte) return (p.innerText = "");
  const heures = qte / cadenceMoyenne;
  const fin = new Date(Date.now() + heures * 3600000);
  p.innerText = "‚è∞ Fin estim√©e √† " + fin.toLocaleTimeString("fr-FR", { hour: "2-digit", minute: "2-digit" });
}

// === GRAPHIQUES ===
function renderGraph(id) {
  const ctx = document.getElementById(id).getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["08h", "10h", "12h", "14h", "16h"],
      datasets: [
        {
          label: "Cadence (colis/h)",
          data: [450, 470, 420, 460, 480],
          backgroundColor: "#007bff88",
          borderColor: "#007bff",
          borderWidth: 1
        }
      ]
    },
    options: {
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { display: false } }
    }
  });
}

// === INITIALISATION ===
document.addEventListener("DOMContentLoaded", () => openPage("Atelier"));
